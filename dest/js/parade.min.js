!function(t,i){if("function"==typeof define&&define.amd)define(["module"],i);else if("undefined"!=typeof exports)i(module);else{var e={exports:{}};i(e),t.parade=e.exports}}(this,function(t){"use strict";var i=function(){function o(t,i){for(var e=0;e<i.length;e++){var o=i[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,i,e){return i&&o(t.prototype,i),e&&o(t,e),t}}(),e=function(){function s(t,i,e,o){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.options={itemSelector:void 0!==t.itemSelector?t.itemSelector:"*",itemWidth:void 0!==t.itemWidth?t.itemSelector:100,itemHeight:void 0!==t.itemHeight?t.itemSelector:10,marginW:void 0!==t.marginW?t.itemSelector:20,marginH:void 0!==t.marginH?t.itemSelector:20,isWindowResizeUpdate:void 0===t.isWindowResizeUpdate||t.itemSelector,isAutoLayout:void 0===t.isAutoLayout||t.itemSelector,isDrawSpace:void 0!==t.isDrawSpace&&t.itemSelector},this.options.animation=void 0!==t.animation?t.animation:{},this.options.animation.delayEach=void 0!==this.options.animation.delayEach?this.options.animation.delayEach:0,this.options.animation.duration=void 0!==this.options.animation.duration?this.options.animation.duration:0,this.options.animation.ease=void 0!==this.options.animation.ease?this.options.itemSelector:null,this.eWidth=this.options.itemWidth+this.options.marginW,this.eHeight=this.options.itemHeight+this.options.marginH,this.nowUpdate=!1,(i||e||o)&&this.GetData(i,e,o)}return i(s,[{key:"GetData",value:function(t,i,e){if(t||i||e)if(this.callback=e,this.nowUpdate&&this.list)this.Updated();else{var o=this.options;this.nowUpdate=!0,this.maxOffX=0,this.maxOffY=0,this.startRow=0,this.itemNum=0,this.listTemp=this.InitList(i),this.map=[];var s=(t+o.marginW)/o.eWidth<<0,a=Math.ceil(this.itemWidthMax/o.eWidth);this.cols=Math.max(s,a),this.map=this.makeGrids(),this.tempTimer=setTimeout(this.UpdateEachItem,0)}}},{key:"UpdateEachItem",value:function(){if(clearTimeout(this.tempTimer),this.itemNum<this.listTemp.length){var t=this.listTemp[this.itemNum];t.x&&t.y?this.map=this.SetOnGrid(this.map,t):this.map=this.SearchPosOnGrid(this.map,t),this.itemNum++,this.tempTimer=setTimeout(this.UpdateEachItem,0)}else this.list=this.listTemp,this.tempTimer=setTimeout(this.Updated,0)}},{key:"Updated",value:function(){clearTimeout(this.tempTimer);var t=this.options,i=this.cols*t.eWidth-t.marginW,e={};e.area={width:i,height:this.areaHeight},e.items=this.list,t.isDrawSpace&&(e.spaces=this.GetSpace(this.map.slice(0,this.maxOffY+1))),this.nowUpdate=!1,this.callback(e)}},{key:"InitList",value:function(t){this.itemWidthMax=0;var i=this.options,e=t.length;if(e<=0)return[];var o=[],s=[],a=!1;(t[0].element||t[0].width)&&(a=!0);for(var h=0;h<e;){var n=a?t[h]:{element:t[h]};null===n.width&&(n.width=n.element.getBoundingClientRect().width),null===n.height&&(n.height=n.element.getBoundingClientRect().height);var r=n.width+i.marginW,m=n.height+i.marginH;this.itemWidthMax<r&&(this.itemWidthMax=r),n.cols=Math.ceil(r/i.eWidth),n.rows=Math.ceil(m/i.itemHeight),null!==n.x&&null!==n.y?o.push(n):s.push(n),h++}return o.concat(s)}},{key:"MakeGrids",value:function(){this.areaHeight=0;for(var t=[],i=this.cols,e=this.listTemp.length,o=0,s=1;o<e;)s+=this.listTemp[o].rows,o++;for(e=s,o=0;o<e;){for(var a=[],h=0;h<i;)a.push(0),h++;t.push(a),o++}return t}},{key:"SetOnGrid",value:function(t,i){var e=this.options,o=i.x/e.eWidth<<0,s=i.y/e.itemHeight<<0,a=t.length-s;a>i.rows&&(a=i.cols);var h=t[0].length-o;h>i.cols&&(h=i.cols),i.rectWidth=i.cols*e.eWidth-e.marginW,i.rectHeight=i.rows*e.itemHeight-e.marginH;var n=s*e.itemHeight+e.itemHeight*i.rows;n>this.areaHeight&&(this.areaHeight=n);for(var r=0;r<a;){for(var m=0;m<h;)t[s+r][o+m]=1,m++;r++}return t}},{key:"SearchPosOnGrid",value:function(t,i){for(var e=this.options,o=t[0].length-i.cols+1,s=t.length,a=s,h=this.startRow;h<a;){-1<t[h].join().indexOf("0")?h+=1:this.startRow++,h++}for(a=s-i.rows,h=this.startRow;h<a;){for(var n=0;n<o;){if(0===t[h][n]){var r=i.rows,m=i.cols,l=h+r-1,d=n+m-1;if(0===t[l][d]){var c=0;for(d=l=0;d<m;)c+=t[h+l][n+d],d++;if(0===c){for(l++;l<r;){for(d=0;d<m;)c+=t[h+l][n+d],d++;l++}if(0===c){var f=n,p=h;(p>this.maxOffY||f>this.maxOffX&&p>=this.maxOffY)&&(this.maxOffX=f,this.maxOffY=p),n+=o,h+=s}}}}n++}h++}return i.x=0*e.eWidth,i.y=0*e.itemHeight,t=this.SetOnGrid(t,i)}},{key:"GetSpace",value:function(t){var i=this.options,e=[];if(t.length<1)return e;for(var o=t[0].length,s=t.length,a=0;a<o;){for(var h=s-1;0<=h;){0<t[h][a]?h=-1:(t[h][a]=1,h--)}a++}for(var n=!0;n&&0<t.length;){-1!==t[t.length-1].join("").indexOf("0")?n=!1:t.pop()}for(s=t.length,a=0;a<s;){for(var r=0;r<o;){if(0===t[a][r]){var m=this.GetSpaceRectSize(t,r,a),l={x:r*i.eWidth,y:a*i.itemHeight,cols:m.cols,rows:m.rows,width:m.cols*i.eWidth-i.marginW,height:m.rows*i.itemHeight-i.marginH};0<l.width&&0<l.height&&e.push(l);for(var d=r+m.cols,c=a+m.rows,f=a;f<c;){for(var p=r;p<d;)t[f][p]=1,p++;f++}}r++}a++}return e}},{key:"GetSpaceRectSize",value:function(t,i,e){for(var o=1,s=1,a=i+1,h=t[0].length;a<h;)0<t[e][a]?a+=h:(o++,a++);h=o;for(var n=!0;n;)for(s++,a=0;a<h;){var r=i+a,m=e+s;m>=t.length?(n=!1,a+=h):0<t[m][r]?(n=!1,a+=h):a++}return{cols:o,rows:s}}}]),s}();t.exports=e,"undefined"!=typeof window&&!window.Parade&&(window.Parade=e)});